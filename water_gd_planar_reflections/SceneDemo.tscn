[gd_scene load_steps=27 format=3 uid="uid://jvqetltjmfln"]

[ext_resource type="Material" uid="uid://c4p4jr823j1gw" path="res://water_gd_planar_reflections/ReflectionMaterial.tres" id="1_31ghw"]
[ext_resource type="Script" uid="uid://b66hrw8ajguo0" path="res://water_gd_planar_reflections/PlanarReflection.gd" id="1_qfd56"]
[ext_resource type="Shader" uid="uid://ry7b8gwavbyf" path="res://water_gd_planar_reflections/planar_reflection_ortho_working_improved.gdshader" id="3_4dgxo"]
[ext_resource type="Script" uid="uid://3tymjwcdughs" path="res://src/DisplayAndCamera/CameraRigController.cs" id="3_o64fk"]
[ext_resource type="Script" uid="uid://cqrnrxjd2army" path="res://water_gd_planar_reflections/PlanarReflectorOrtho.gd" id="4_27fyg"]
[ext_resource type="Script" uid="uid://cih20r8djkwwk" path="res://src/DisplayAndCamera/CameraPixelSnap.cs" id="6_e16cc"]
[ext_resource type="Script" uid="uid://bjw4vo4kncqf0" path="res://src/DisplayAndCamera/DisplayPixelRenderer.cs" id="7_4dgxo"]
[ext_resource type="Shader" uid="uid://b8w6ukv0awrxw" path="res://Assets/Shaders/PixelShaders/pixel_art_upscale_v2.gdshader" id="8_iuvjp"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_qo5mp"]
sky_horizon_color = Color(0.662243, 0.671743, 0.686743, 1)
ground_horizon_color = Color(0.662243, 0.671743, 0.686743, 1)

[sub_resource type="Sky" id="Sky_2vqx1"]
sky_material = SubResource("ProceduralSkyMaterial_qo5mp")

[sub_resource type="Environment" id="Environment_3u57c"]
background_mode = 2
sky = SubResource("Sky_2vqx1")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="PlaneMesh" id="PlaneMesh_06xb3"]
resource_local_to_scene = true
material = ExtResource("1_31ghw")
size = Vector2(10, 10)
subdivide_width = 20
subdivide_depth = 20

[sub_resource type="ViewportTexture" id="ViewportTexture_4dgxo"]
viewport_path = NodePath("SubViewport/PlanarReflectorOrtho/@SubViewport@158248")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_4dgxo"]
seed = 10

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_4dgxo"]
seamless = true
as_normal_map = true
noise = SubResource("FastNoiseLite_4dgxo")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_iuvjp"]
seed = 10

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_7vq4r"]
seamless = true
as_normal_map = true
noise = SubResource("FastNoiseLite_iuvjp")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_7vq4r"]
seed = 10

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_t5pnn"]
seamless = true
as_normal_map = true
noise = SubResource("FastNoiseLite_7vq4r")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_psr7x"]
resource_local_to_scene = true
render_priority = -10
shader = ExtResource("3_4dgxo")
shader_parameter/albedo = Color(0.290196, 0.52549, 0.670588, 1)
shader_parameter/metallic = 0.0
shader_parameter/roughness = 0.0
shader_parameter/specular = 1.0
shader_parameter/reflection_screen_texture = SubResource("ViewportTexture_4dgxo")
shader_parameter/reflection_strength = 0.5
shader_parameter/texture_normal = SubResource("NoiseTexture2D_4dgxo")
shader_parameter/texture_normal2 = SubResource("NoiseTexture2D_7vq4r")
shader_parameter/normal_scale = 0.0
shader_parameter/normal_uv_mult = 16.0
shader_parameter/distortion_strength = 0.01
shader_parameter/uv1_scale = Vector3(0, 0, 0)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/texture_refraction = SubResource("NoiseTexture2D_t5pnn")
shader_parameter/refraction = 0.0
shader_parameter/refraction_texture_channel = Vector4(1, 1, 1, 1)
shader_parameter/proximity_fade_distance = 0.5
shader_parameter/is_orthogonal_camera = false
shader_parameter/ortho_uv_scale = 1.0

[sub_resource type="PlaneMesh" id="PlaneMesh_4ivak"]
resource_local_to_scene = true
material = SubResource("ShaderMaterial_psr7x")
size = Vector2(10, 10)
subdivide_width = 20
subdivide_depth = 20

[sub_resource type="CylinderMesh" id="CylinderMesh_tqrmm"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_kbcca"]
albedo_color = Color(1, 0.227451, 1, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_4dgxo"]
albedo_color = Color(0.23, 0.358333, 1, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_7vq4r"]
shader = ExtResource("8_iuvjp")
shader_parameter/shadow_boost = 1.2
shader_parameter/shadow_threshold = 0.46
shader_parameter/shadow_color_override = Color(1, 1, 1, 1)
shader_parameter/use_shadow_color_override = false
shader_parameter/light_boost = 1.05

[sub_resource type="ViewportTexture" id="ViewportTexture_psr7x"]
viewport_path = NodePath("SubViewport")

[node name="Node3D" type="Node3D"]

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.866025, -0.433013, 0.25, 0, 0.5, 0.866025, -0.5, 0.75, -0.433013, 0, 0, 0)
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_3u57c")

[node name="SubViewport" type="SubViewport" parent="."]
handle_input_locally = false
size = Vector2i(470, 280)
render_target_update_mode = 4

[node name="PlanarReflector" type="MeshInstance3D" parent="SubViewport" node_paths=PackedStringArray("main_cam")]
visible = false
mesh = SubResource("PlaneMesh_06xb3")
skeleton = NodePath("../..")
script = ExtResource("1_qfd56")
main_cam = NodePath("../CamRig/Camera3D")
metadata/_custom_type_script = "uid://b66hrw8ajguo0"

[node name="PlanarReflectorOrtho" type="MeshInstance3D" parent="SubViewport" node_paths=PackedStringArray("main_cam")]
layers = 524289
mesh = SubResource("PlaneMesh_4ivak")
skeleton = NodePath("../PlanarReflector")
script = ExtResource("4_27fyg")
main_cam = NodePath("../CamRig/Camera3D")
reflection_camera_resolution = Vector2i(640, 360)
reflection_layer = 20

[node name="CamRig" type="Node3D" parent="SubViewport" node_paths=PackedStringArray("RotationPivotPoint", "MainCamera")]
script = ExtResource("3_o64fk")
RotationPivotPoint = NodePath("../Objects/Cylinder")
MainCamera = NodePath("Camera3D")

[node name="Camera3D" type="Camera3D" parent="SubViewport/CamRig"]
transform = Transform3D(1, 0, 0, 0, 0.854005, 0.520265, 0, -0.520265, 0.854005, 0, 5.92773, 9.00519)
projection = 1
current = true
size = 10.0
far = 100.0
script = ExtResource("6_e16cc")

[node name="Objects" type="Node3D" parent="SubViewport"]

[node name="Cylinder" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.03768, -0.886394)
layers = 524289
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_kbcca")

[node name="Cylinder2" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.70029, -0.00114685, -0.413378)
layers = 524289
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_kbcca")

[node name="Cylinder3" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3.12525, -0.00114685, -3.37019)
layers = 524289
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_kbcca")

[node name="Cylinder4" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.73761, -0.00114685, -5.49114)
layers = 524289
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_kbcca")

[node name="Cylinder5" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.73761, -0.00114685, 1.34151)
layers = 524289
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_kbcca")

[node name="Cylinder6" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -6.78605, 1.31335, 1.34151)
visible = false
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Cylinder7" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -6.78605, -0.153427, -4.77189)
visible = false
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Cylinder8" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -6.78605, -0.153427, -1.53608)
visible = false
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Cylinder9" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -6.78605, 1.54497, -6.86557)
visible = false
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Cylinder10" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.75761, -0.349704, -6.86557)
visible = false
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Cylinder11" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.75761, -1.90759, -0.00102949)
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Cylinder12" type="MeshInstance3D" parent="SubViewport/Objects"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.872242, 0.262787, 1.62197)
mesh = SubResource("CylinderMesh_tqrmm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("StandardMaterial3D_4dgxo")

[node name="Display" type="Control" parent="." node_paths=PackedStringArray("_viewport", "_mainRendereSprite")]
clip_contents = true
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
scale = Vector2(1.01507, 1.01103)
size_flags_horizontal = 3
size_flags_vertical = 3
mouse_filter = 2
script = ExtResource("7_4dgxo")
_viewport = NodePath("../SubViewport")
_mainRendereSprite = NodePath("MainRenderSprite")

[node name="MainRenderSprite" type="Sprite2D" parent="Display"]
texture_filter = 2
material = SubResource("ShaderMaterial_7vq4r")
position = Vector2(-0.985153, 3.95636)
scale = Vector2(2.93853, 2.96452)
texture = SubResource("ViewportTexture_psr7x")
centered = false
